<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vito S√©ries</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <button id="random-series" class="nav-button">S√©rie Aleat√≥ria</button>

        <div class="filter-bar">
          <button class="filter-emoji" data-filter="ü•á">
            <img class="img-emoji" src="img/gold.png" alt="Medalha de ouro" />
          </button>
          <button class="filter-emoji" data-filter="ü•à">
            <img class="img-emoji" src="img/silver.png" alt="Medalha de prata" />
          </button>
          <button class="filter-emoji" data-filter="ü•â">
            <img class="img-emoji" src="img/bronze.png" alt="Medalha de bronze" />
          </button>
        </div>

        <div class="search-bar">
          <input type="text" id="search" placeholder="Buscar s√©rie..." />
          <button id="search-button">Buscar</button>
        </div>
      </header>
      
      <main>
        <div id="series-grid" class="series-grid">
          <!-- S√©ries ser√£o carregadas dinamicamente aqui -->
        </div>
      </main>
    </div>

    <script>
      let seriesData = [];
      let currentFilter = null; // Vari√°vel para armazenar o filtro atual

      // Fun√ß√£o para carregar as s√©ries a partir do JSON
      function loadSeries() {
        return fetch("series.json")
          .then((response) => response.json())
          .then((data) => {
            seriesData = data; // Armazena os dados para uso posterior na busca e filtro
            displaySeries(seriesData); // Exibe as s√©ries inicialmente
          })
          .catch((error) => console.error("Erro ao carregar s√©ries:", error));
      }

      // Fun√ß√£o para exibir as s√©ries
      function displaySeries(series) {
        const grid = document.getElementById("series-grid");
        grid.innerHTML = ""; // Limpa o grid antes de exibir novas s√©ries
        series.forEach((serie) => {
          const serieElement = `
            <a href="serie.html?id=${serie.id}">
              <img src="${serie.imagem}" alt="Capa da s√©rie ${serie.titulo}">
              <h2>${serie.titulo}${serie.avaliacao}</h2>
            </a>
          `;
          grid.innerHTML += serieElement;
        });
      }

      // Fun√ß√£o para pesquisar s√©ries
      function searchSeries() {
        const searchTerm = document.getElementById("search").value.toLowerCase();
        const filteredSeries = seriesData.filter((serie) =>
          serie.titulo.toLowerCase().includes(searchTerm)
        );
        displaySeries(filteredSeries); // Exibe apenas as s√©ries que correspondem √† busca
      }

      // Fun√ß√£o para filtrar s√©ries por avalia√ß√£o (ü•á, ü•à, ü•â)
      function filterByAvaliacao(avaliacao) {
        if (currentFilter === avaliacao) {
          // Se o filtro j√° estiver ativo, remove o filtro e exibe todas as s√©ries
          currentFilter = null;
          displaySeries(seriesData);
        } else {
          // Se o filtro n√£o estiver ativo, aplica o filtro
          currentFilter = avaliacao;
          const filteredSeries = seriesData.filter(
            (serie) => serie.avaliacao === avaliacao
          );
          displaySeries(filteredSeries); // Exibe apenas as s√©ries que correspondem ao filtro
        }
      }

      // Fun√ß√£o para selecionar uma s√©rie aleat√≥ria
      function randomSeries() {
        if (seriesData.length === 0) return; // Verifica se h√° s√©ries carregadas
        const randomIndex = Math.floor(Math.random() * seriesData.length);
        const randomSerie = seriesData[randomIndex];
        window.location.href = `serie.html?id=${randomSerie.id}`;
      }

      // Fun√ß√£o para verificar o par√¢metro de busca na URL e realizar a pesquisa
      function checkSearchParam() {
        const urlParams = new URLSearchParams(window.location.search);
        const searchTerm = urlParams.get('search');
        
        if (searchTerm) {
          document.getElementById("search").value = searchTerm;
          searchSeries(); // Executa a busca automaticamente
        }
      }

      // Event listeners
      document.getElementById("random-series").addEventListener("click", randomSeries);
      document.getElementById("search-button").addEventListener("click", searchSeries);

      // Event listeners para os emojis de filtro
      document.querySelectorAll(".filter-emoji").forEach((button) => {
        button.addEventListener("click", function () {
          const avaliacao = button.getAttribute("data-filter");
          filterByAvaliacao(avaliacao);
        });
      });

      // Listener para busca com "Enter"
      document.getElementById("search").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          searchSeries(); // Aciona a busca ao pressionar Enter
        }
      });

      // Carrega as s√©ries e s√≥ ent√£o verifica o termo de busca
      window.addEventListener("load", () => {
        loadSeries().then(() => {
          checkSearchParam(); // S√≥ executa a busca depois que as s√©ries forem carregadas
        });
      });
    </script>
  </body>
</html>
